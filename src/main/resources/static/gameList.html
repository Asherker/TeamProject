<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>åº«å­˜ç®¡ç†ç³»çµ±</title>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/gameDetail.css">
<link rel="stylesheet" href="css/addGames.css">
	<!-- é€™æ˜¯æŒ‰éµçš„CSS -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

	<!-- å¼•å…¥axioså¥—ä»¶ï¼Œç”¨ä¾†é€éHTTPå”å®šåœ¨ç¶²é å…§å‘¼å«å¾Œç«¯çš„API -->
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

	<!-- å¼•å…¥Vue.js -->
	<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

	<!-- å¼•å…¥Element UIä»‹é¢åº«-->
	<!-- Import style -->
	<link rel="stylesheet" href="//unpkg.com/element-plus/dist/index.css" />
	<!-- Import Vue 3 -->
	<script src="//unpkg.com/vue@3"></script>
	<!-- Import component library -->
	<script src="//unpkg.com/element-plus"></script>
</head>

<body id="app">
	<!--Hey! This is the original version
of Simple CSS Waves-->

	<div class="header">

		<!--Content before waves-->
		<div class="inner-header flex">
		<!--Just the logo.. Don't mind this-->
		<svg version="1.1" class="logo" baseProfile="tiny" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
		xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 500 500" xml:space="preserve">
		<path fill="#FFFFFF" stroke="#000000" stroke-width="10" stroke-miterlimit="10" d="M57,283" />
		<g><path fill="#fff"
		d="M250.4,0.8C112.7,0.8,1,112.4,1,250.2c0,137.7,111.7,249.4,249.4,249.4c137.7,0,249.4-111.7,249.4-249.4
		C499.8,112.4,388.1,0.8,250.4,0.8z M383.8,326.3c-62,0-101.4-14.1-117.6-46.3c-17.1-34.1-2.3-75.4,13.2-104.1
		c-22.4,3-38.4,9.2-47.8,18.3c-11.2,10.9-13.6,26.7-16.3,45c-3.1,20.8-6.6,44.4-25.3,62.4c-19.8,19.1-51.6,26.9-100.2,24.6l1.8-39.7		c35.9,1.6,59.7-2.9,70.8-13.6c8.9-8.6,11.1-22.9,13.5-39.6c6.3-42,14.8-99.4,141.4-99.4h41L333,166c-12.6,16-45.4,68.2-31.2,96.2	c9.2,18.3,41.5,25.6,91.2,24.2l1.1,39.8C390.5,326.2,387.1,326.3,383.8,326.3z" />
		</g>
		</svg>
		<h1>éŠæˆ²å•†å“åº«å­˜ç®¡ç†ç³»çµ±</h1>
		</div>
		
		<!--Waves Container-->
		<div style="position: relative;">
		<svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
		viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
		<defs>
		<path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
		</defs>
		<g class="parallax">
		<use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7" />
		<use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)" />
		<use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)" />
		<use xlink:href="#gentle-wave" x="48" y="7" fill="#fff" />
		</g>
		</svg>
		</div>
		<!--Waves end-->
		
	</div>
	<!--Header ends-->
	
	<!-- é¸å–® -->
	<div class="all">
		<div class="lefter" @click="onLogin()">
		  <div class="text">ç™»å…¥</div>
		</div>
		<div class="left">
		  <div class="text">Web Design</div>
		</div>
		<div class="center">
		  <div class="explainer"><span>â˜…</span></div>
		  <div class="text">Frontend Development</div>
		  </div>
		<div class="right">
		  <div class="text">è³‡æ–™å‚™ä»½èˆ‡å›æº¯</div>
		</div>
		<div class="righter">
		  <div class="text">SEO</div>
		</div>
	</div>
		
	<!-- <a href="https://jouanmarcel.com" target="_blank" class="ref">ğŸ”— Jouan Marcel</a> -->
	



    <div class="m-4 remote-option">
        <h2>éŠæˆ²ç”¢å“æœå°‹å¼•æ“</h2>
        <el-select v-model="value" filterable remote reserve-value placeholder="è«‹è¼¸å…¥éŠæˆ²åç¨±" remote-show-suffix
            :remote-method="remoteMethod" :loading="loading">
            <el-option v-for="item in options" :key="item.value" :label="item.label" :value="item.value" />
        </el-select>

        <el-button type="primary" @click="onShowDetail(value)">é€å‡º</el-button>

		<!-- éŠæˆ²å½ˆçª— -->
		<div v-if="showDetail" class="grid-1-5">
		<h3><span class="uppercase">{{ gameDetail.chname }}</span></h3>
		<h2>{{ gameDetail.enname }}</h2>
		<h2>ç™¼è¡Œå¹´: {{ gameDetail.devyear }}</h2>
		<h3>éŠæˆ²ä»‹ç´¹</h3>
		<p class="game-description">{{ gameDetail.description }}</p>&nbsp;&nbsp;
		<div class="button clickable" @click="showDetail = false">é—œ é–‰</div>
		</div>
    </div>

  <div class="container">

	<div @click="showAddGameModal = true" class="material-symbols-outlined">
		add
	</div>&nbsp;&nbsp;
	<div @click="toRecord" class="material-symbols-outlined">
		browse_activity
	</div>
	<table>
		<thead>
			<tr>
				<th>ç·¨è™Ÿ</th>
				<th>éŠæˆ²åç¨±</th>
				<th>ç¨®é¡</th>
				<th>é–‹ç™¼å•†</th>
				<th>å¹³å°</th>
				<th style="display: flex; align-items: center; justify-content: center; cursor: pointer;" @click="onChangeMode">
					åƒ¹æ ¼<div v-if="priceArrowMode != 0" :class="[priceArrowMode == 1 ? '':'arrow-down']">â–²</div>
				</th>
				<th>åº«å­˜æ•¸é‡</th>
				<th>æœ€æ–°é€²è²¨æ—¥æœŸ</th>
				<th>æœ€å¾Œå‡ºè²¨æ—¥æœŸ</th>
				<th class="func">åŠŸèƒ½</th>
			</tr>
		</thead>
		<!-- æ¸…å–® -->
		<tbody>
			<tr v-for="(item , index) in games">
				<td>
					<div v-if="!showEditMode[index]">{{ item.id }}</div>
					<input class="idinput" v-else v-model="games[index].id" placeholder="Please input" />
				</td>
				<td>
					<div v-if="!showEditMode[index]">{{ item.name }}</div>
					<el-input v-else v-model="games[index].name" placeholder="Please input" />
				</td>
				<td>
					<div v-if="!showEditMode[index]">{{ item.category }}</div>
					<el-input v-else v-model="games[index].category" placeholder="Please input" />
				</td>
				<td>
					<div v-if="!showEditMode[index]">{{ item.developer }}</div>
					<el-input v-else v-model="games[index].developer" placeholder="Please input" />
				</td>
				<td>
					<div v-if="!showEditMode[index]">{{ item.platform }}</div>
					<el-select v-else v-model="games[index].platform" class="m-2" placeholder="è«‹é¸æ“‡å¹³å°" size="large">
						<el-option
						  v-for="item in platformOptions"
						  :key="item.value"
						  :label="item.label"
						  :value="item.value"
						/>
					</el-select>
				</td>
				<td>
					<div v-if="!showEditMode[index]">{{ item.price }}</div>
					<el-input-number v-else v-model="games[index].price" @change="handleChange" />
				</td>
				<td>
					<div v-if="!showEditMode[index]">{{ item.quantity }}</div>
					<el-input-number v-else v-model="games[index].quantity" @change="handleChange" />
				</td>
				<td>
					<div v-if="!showEditMode[index]">{{ item.inchange }}</div>
					<el-date-picker v-else v-model="games[index].inchange" type="date" placeholder="Pick a day" :size="size" />
				</td>
				<td>
					<div v-if="!showEditMode[index]">{{ item.outchange }}</div>
					<el-date-picker v-else v-model="games[index].outchange" type="date" placeholder="Pick a day" :size="size" />
				</td>
				<td>
				<span @click="showEditMode[index] = true" v-if="!showEditMode[index]" class="material-symbols-outlined">
				edit_note
				</span>&nbsp;
				<span @click="onDelete(item.id) ,this.discription = 3, onRecordInsert(item.id)" v-if="!showEditMode[index]" class="material-symbols-outlined">
				delete
				</span>
				<span @click="onUpdate(index), this.discription = 1, onRecordInsert(item.id) " v-if="showEditMode[index]" class="material-symbols-outlined">
					done
				</span>&nbsp;
				<span @click="showEditMode[index] = false" v-if="showEditMode[index]" class="material-symbols-outlined">
					Close
				</span>
				</td>
			</tr>
		</tbody>
	</table>

	<el-pagination background layout="prev, pager, next, sizes" 
	:total="total" 
	:page-sizes="[ 10, 20]"
	style="justify-content: center;margin-bottom: 25px;"
	@size-change="onSizeChange" 
	@current-change="onCurrentChange" 
	@prev-click="onPrevClick" 
	@next-click="onNextClick"
	v-model:current-page="currentPage" 
	v-model:page-size="pageSize" />

</div>


	<!-- æ–°å¢éŠæˆ²çš„å°è©±ç›’ -->
	<div class="form" v-if="showAddGameModal">
		<div class="title">æ–°å¢éŠæˆ²è³‡æ–™</div>
		<div class="input-container ic2">
			<input id="email" class="input" type="text" v-model="newGameData.id" placeholder=" " />
			<div class="cut cut-short"></div>
			<label for="email" class="placeholder">ç”¢å“ç·¨è™Ÿ</label>
		</div>
		<div class="input-container ic1">
			<input id="firstname" class="input" type="text" v-model="newGameData.name" placeholder=" " />
			<div class="cut"></div>
			<label for="firstname" class="placeholder">éŠæˆ²åç¨±</label>
		</div>
		<div class="input-container ic2">
			<input id="email" class="input" type="text" v-model="newGameData.category" placeholder=" " />
			<div class="cut cut-short"></div>
			<label for="email" class="placeholder">ç¨®é¡</label>
		</div>
		
		<div class="input-container ic2">
			<input id="email" class="input" type="text" v-model="newGameData.developer" placeholder=" " />
			<div class="cut cut-short"></div>
			<label for="email" class="placeholder">é–‹ç™¼å•†</label>
		</div>
		<div class="btn-group">
			<div class="input-container ic2">
				<input id="email" class="input" type="number" v-model="newGameData.price" placeholder=" " />
				<div class="cut cut-short"></div>
				<label for="email" class="placeholder">åƒ¹æ ¼</label>
			</div>
			<div class="input-container ic2">
				<input id="email" class="input" type="number" v-model="newGameData.quantity" placeholder=" " />
				<div class="cut cut-short"></div>
				<label for="email" class="placeholder">åº«å­˜æ•¸é‡</label>
			</div>
		</div>
		<div class="input-container ic2">
			<span class="add-game-title">å¹³å°&nbsp;&nbsp;</span>
			<el-select v-model="newGameData.platform" class="m-2" placeholder="Select" size="large">
				<el-option
				  v-for="item in platformOptions"
				  :key="item.value"
				  :label="item.label"
				  :value="item.value"
				/>
			</el-select>
		</div>
		
		<div class="input-container ic2">
			<span class="add-game-title">æœ€æ–°é€²è²¨æ—¥&nbsp;&nbsp;</span>
			<el-date-picker
				v-model="newGameData.inchange"
				type="date"
				placeholder="è«‹é¸æ“‡é€²è²¨æ—¥æœŸ"
				:size="size"
			/>
		</div>
		<div class="input-container ic2">
			<span class="add-game-title">æœ€å¾Œå‡ºè²¨æ—¥&nbsp;&nbsp;</span>
			<el-date-picker
				v-model="newGameData.outchange"
				type="date"
				placeholder="è«‹é¸æ“‡å‡ºè²¨æ—¥æœŸ"
				:size="size"
			/>
		</div>

		<div class="btn-group">
			<button type="text" class="submit" @click="showAddGameModal = false">å–æ¶ˆ</button>
			<button type="text" class="submit" @click="onAdd(), this.discription = 2, onRecordInsert(newGameData.id)">é€å‡º</button>
		</div>
	</div>

</body>

</html>

</body>
<script>
	// Vueåˆå§‹åŒ–
	const { createApp } = Vue

	createApp({
		data() {
			// ç¶²é è¦ä½¿ç”¨çš„è®Šæ•¸æ”¾é€™è£¡
			return {
				message: 'Hello Vue!',
				games: [],
				showDetail: false,
				gameDetail: {},
				showAddGameModal: false,
				platformOptions: [
					{
						value: "PlayStation4/5",
						label: "PlayStation4/5",
					},
					{
						value: "Nintendo Switch",
						label: "Nintendo Switch",
					},
				],
				//æœå°‹å¼•æ“ç”¨çš„
				value: '',
                options: [],
				loading: false,
                showResult: false,

				// ä½¿ç”¨è€…çš„é¸æ“‡ç¨®é¡æœƒå­˜åœ¨é€™é‚Š
				categoryValue: 'ç¨®é¡',

				newGameData: {
					id:'',
					name: '',
					category: '',
					developer: '',
					platform: '',
					price: 0,
					quantity: 0,
					inchange: null,
					outchange: null,
				},

				showEditMode: [],

				deleteDataIndex: {
					id:'',
				},
				currentPage: 1,
        		pageSize: 10,
       			total: 0,
				priceArrowMode:0,
				userdata:{
					id:null,
					gameid:'',
					user: '',
					movement:'',
					updatetime:'',
				},
				discription: 0,
				
			}
		},
		watch: {
			currentPage(newVal,oldVal) {

			},
			pageSize(newVal, oldVal) {

			},
		},
		// ç•¶ç¶²é è¼‰å…¥å®Œæˆå¾Œæœƒè¢«Vueæ¡†æ¶å‘¼å«
		mounted() {
			this.fetch();
			let ud = localStorage.getItem('user');
			this.userdata.user = JSON.parse(ud);

		},
		// ç¶²é è¦ç”¨çš„æ–¹æ³•å¯«åœ¨é€™è£¡
		methods: {
			onLogin() {
				location.href = "/index.html";
			},
			onChangeMode(){
				this.currentPage = 1;

			if(this.priceArrowMode == 0) this.priceArrowMode = 1;        
        	else if(this.priceArrowMode == 1) this.priceArrowMode = 2;
        	else
         	this.priceArrowMode = 0;
			// é‡æ–°æ‰“APIæ’åº
        	this.fetch();
			},
			onSizeChange(size) {
				this.currentPage = 1;
				this.fetch();
			},
			onCurrentChange() {
				this.fetch();
			},
			//åˆ†é è¢«é»æ“Šäº†ä¸Šä¸€é 
			onPrevClick(page) {

			},
			//åˆ†é è¢«é»æ“Šäº†ä¸‹ä¸€é 
			onNextClick(page) {

			},
			fetch() {
				//APIå»è·Ÿå¾Œç«¯åšè³‡æ–™
				axios.get('/list/games?page=' + this.currentPage + '&count=' + this.pageSize + "&SortMode=" + this.priceArrowMode)
				.then((response) => {
					//getå®Œæˆå¾Œæ”¶åˆ°çš„è³‡æ–™å¯åœ¨é€™è£¡è™•ç†
					console.log(response);
					//å°‡APIå•†å“è³‡æ–™å­˜åˆ°Vueæ‰€å»ºç«‹çš„productsè®Šæ•¸å…§
					if(response.data.code == 0) {
					//å†å°‡APIæ‹¿åˆ°çš„Dataå­˜åˆ°Vueè®Šæ•¸
					this.total = response.data.data.total;
					this.games = response.data.data.games;
					} else if(response.data.code == 9) {
						location.href = "/index.html"
					}
				})
				.catch((error) => {
					console.log(error);
				});
			},
			//æ–°å¢è³‡æ–™
			onAdd() {
				
				// å°‡æ–°å¢è³‡æ–™çš„å°è©±ç›’é¡¯ç¤ºå‡ºä¾†
				console.log(JSON.stringify(this.newGameData));
				//æ‰“APIå°‡è³‡æ–™é€åˆ°å¾Œç«¯
				axios.post('/gameInList', this.newGameData)
					.then((response) => {
						console.log(response);
						if (response.data.code == 0) {
							this.$message.success('æ–°å¢æˆåŠŸ');
							this.showAddGameModal = false;
						}
					})
					.catch((error) => {
						console.log(error);

						this.$message.error('æ–°å¢å¤±æ•—');
					})
			},

			onDelete(id) {
				this.deleteDataIndex.id = id;
				console.log(JSON.stringify(this.deleteDataIndex));
				//æ‰“APIå°‡è³‡æ–™é€åˆ°å¾Œç«¯
				axios.delete('/delgames', {data: this.deleteDataIndex }, {
					headers: {
						'Content-Type': 'application/json',
					}})
					.then((response) => {
						console.log(response);
						if (response.data.code == 0) {
							this.$message.success('åˆªé™¤æˆåŠŸ');
							this.fetch();
						}
					})
					.catch((error) => {
						console.log(error);

						this.$message.error('åˆªé™¤å¤±æ•—');
					})

			},
			onShowDetail(name) {
				// é¡¯ç¤ºè©³ç´°è³‡è¨Šçš„å°è©±ç›’
				this.showDetail = true;

				axios.get("/gameDetail?value=" + name)
					.then((response) => {
						console.log(response);
						if (response.data.code == 0) {
							this.gameDetail = response.data.data;
						}
					})
					.catch((error) => {
						console.log(error);
					});
			},

			toRecord(){
				location.href = '/backTrack.html';
			},

			//ç«‹åˆ»å‚³æ–°çš„æ­·å²ç´€éŒ„é€šçŸ¥
			onRecordInsert(id){
				// å°‡æ–°å¢è³‡æ–™çš„å°è©±ç›’é¡¯ç¤ºå‡ºä¾†
				this.userdata.gameid = id;
				this.userdata.updatetime = new Date();
				console.log(this.userdata.updatetime);
				if (this.discription == 1) {
						this.userdata.movement='ä¿®æ”¹äº†ä¸€ç­†è³‡æ–™';
					} else if (this.discription == 2) {
						this.userdata.movement='æ–°å¢äº†ä¸€ç­†è³‡æ–™';
					} else if (this.discription == 3) {
						this.userdata.movement='åˆªé™¤äº†ä¸€ç­†è³‡æ–™';
					}
				
				console.log(JSON.stringify(this.userdata));

				// æ‰“APIå°‡è³‡æ–™é€åˆ°å¾Œç«¯
				axios.post('/record', this.userdata)
					.then((response) => {
						console.log(response);
						
						if(response.data.code == 0) {
							this.$message.success('æ­·å²ç´€éŒ„æ›´æ–°æˆåŠŸ');
							this.fetch();
						}
					})
					.catch((error) => {
						console.log(error);
						// æ–°å¢å¤±æ•—

						this.$message.error('æ­·å²ç´€éŒ„æ›´æ–°å¤±æ•—');
					});

			},

			//è³‡æ–™ä¿®æ”¹
			onUpdate(index) {
				// å°‡æ–°å¢è³‡æ–™çš„å°è©±ç›’é¡¯ç¤ºå‡ºä¾†
				console.log(JSON.stringify(this.games[index]));

				// æ‰“APIå°‡è³‡æ–™é€åˆ°å¾Œç«¯
				axios.put('/updategames', this.games[index])
					.then((response) => {
						console.log(response);
						if (response.data.code == 0) {
							this.$message.success('æ›´æ–°æˆåŠŸ');
							this.showEditMode[index] = false;
							this.fetch();
						}
					})
					.catch((error) => {
						console.log(error);
						// æ–°å¢å¤±æ•—

						this.$message.error('æ›´æ–°å¤±æ•—');
					});
			},

		
			//å‹•æ…‹é¸é …åŠŸèƒ½
			onShow(message) {
			},
			remoteMethod(query) { 
				console.log('call remoteMoethod: ' + query);

			if (query) {
				axios.get("/gamesearch?keyword=" + query)
					.then((response) => {
						this.options = [];
						console.log(response.data);
						if (response.data.code == 0) {
						for (let v of response.data.data) {
						this.options.push({
							value: v,
							label: v,
						});
					}

					console.log(this.options);
				}
			})
			.catch((error) => {
				console.log(error);
			});
			} else {
				this.options = [];
			}
		}
		}
	}).use(ElementPlus).mount('#app')
</script>

</html>